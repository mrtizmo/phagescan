/* sigmajs.org - an open-source light-weight JavaScript graph drawing library - Version: 0.1 - Author:  Alexis Jacomy - License: MIT */
var sigma={tools:{},classes:{},instances:{}};
(function(){Array.prototype.some||(Array.prototype.some=function(j,g){var m=this.length;if("function"!=typeof j)throw new TypeError;for(var p=0;p<m;p++)if(p in this&&j.call(g,this[p],p,this))return!0;return!1});Array.prototype.forEach||(Array.prototype.forEach=function(j,g){var m=this.length;if("function"!=typeof j)throw new TypeError;for(var p=0;p<m;p++)p in this&&j.call(g,this[p],p,this)});Array.prototype.map||(Array.prototype.map=function(j,g){var m=this.length;if("function"!=typeof j)throw new TypeError;
for(var p=Array(m),b=0;b<m;b++)b in this&&(p[b]=j.call(g,this[b],b,this));return p});Array.prototype.filter||(Array.prototype.filter=function(j,g){var m=this.length;if("function"!=typeof j)throw new TypeError;for(var p=[],b=0;b<m;b++)if(b in this){var l=this[b];j.call(g,l,b,this)&&p.push(l)}return p});if(!Object.keys){var j=Object,t=Object.prototype.hasOwnProperty,g=!{toString:null}.propertyIsEnumerable("toString"),r="toString toLocaleString valueOf hasOwnProperty isPrototypeOf propertyIsEnumerable constructor".split(" "),
C=r.length;j.keys=function(j){if("object"!==typeof j&&"function"!==typeof j||null===j)throw new TypeError("Object.keys called on non-object");var B=[],m;for(m in j)t.call(j,m)&&B.push(m);if(g)for(m=0;m<C;m++)t.call(j,r[m])&&B.push(r[m]);return B}}})();sigma.classes.Cascade=function(){this.p={};this.config=function(j,t){if("string"==typeof j&&void 0==t)return this.p[j];var g="object"==typeof j&&void 0==t?j:{};"string"==typeof j&&(g[j]=t);for(var r in g)void 0!=this.p[r]&&(this.p[r]=g[r]);return this}};
sigma.classes.EventDispatcher=function(){var j={},t=this;this.one=function(g,r){if(!r||!g)return t;("string"==typeof g?g.split(" "):g).forEach(function(g){j[g]||(j[g]=[]);j[g].push({h:r,one:!0})});return t};this.bind=function(g,r){if(!r||!g)return t;("string"==typeof g?g.split(" "):g).forEach(function(g){j[g]||(j[g]=[]);j[g].push({h:r,one:!1})});return t};this.unbind=function(g,r){g||(j={});var C="string"==typeof g?g.split(" "):g;r?C.forEach(function(g){j[g]&&(j[g]=j[g].filter(function(g){return g.h!=
r}));j[g]&&0==j[g].length&&delete j[g]}):C.forEach(function(g){delete j[g]});return t};this.dispatch=function(g,r){j[g]&&(j[g].forEach(function(j){j.h({type:g,content:r,target:t})}),j[g]=j[g].filter(function(g){return!g.one}));return t}};
(function(){function j(b){var l=b.changedTouches[0],f="";switch(b.type){case "touchstart":f="mousedown";break;case "touchmove":f="mousemove";break;case "touchend":f="mouseup";break;default:return}var c=document.createEvent("MouseEvent");c.initMouseEvent(f,!0,!0,window,1,l.posX,l.posY,l.clientX,l.clientY,!1,!1,!1,!1,0,null);l.target.dispatchEvent(c);b.preventDefault()}function t(b){function l(d){a.p.mouseEnabled&&(f(a.mouseX,a.mouseY,a.ratio*(0<(void 0!=d.wheelDelta&&d.wheelDelta||void 0!=d.detail&&
-d.detail)?a.p.zoomMultiply:1/a.p.zoomMultiply)),a.p.blockScroll&&(d.preventDefault?d.preventDefault():d.returnValue=!1))}function f(d,b,s){if(!a.isMouseDown&&(window.clearInterval(a.interpolationID),p=void 0!=s,D=a.stageX,z=d,q=a.stageY,n=b,h=s||a.ratio,h=Math.min(Math.max(h,a.p.minRatio),a.p.maxRatio),w=a.p.directZooming?1-(p?a.p.zoomDelta:a.p.dragDelta):0,a.ratio!=h||a.stageX!=z||a.stageY!=n))c(),a.interpolationID=window.setInterval(c,50),a.dispatch("startinterpolate")}function c(){w+=p?a.p.zoomDelta:
a.p.dragDelta;w=Math.min(w,1);var d=sigma.easing.quadratic.easeout(w),c=a.ratio;a.ratio=c*(1-d)+h*d;p?(a.stageX=z+(a.stageX-z)*a.ratio/c,a.stageY=n+(a.stageY-n)*a.ratio/c):(a.stageX=D*(1-d)+z*d,a.stageY=q*(1-d)+n*d);a.dispatch("interpolate");1<=w&&(window.clearInterval(a.interpolationID),d=a.ratio,p?(a.ratio=h,a.stageX=z+(a.stageX-z)*a.ratio/d,a.stageY=n+(a.stageY-n)*a.ratio/d):(a.stageX=z,a.stageY=n),a.dispatch("stopinterpolate"))}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);
var a=this;this.p={minRatio:1,maxRatio:32,marginRatio:1,zoomDelta:0.1,dragDelta:0.3,zoomMultiply:2,directZooming:!1,blockScroll:!0,inertia:1.1,mouseEnabled:!0,touchEnabled:!0};var s=0,d=0,D=0,q=0,h=1,z=0,n=0,x=0,u=0,g=0,m=0,w=0,p=!1;this.stageY=this.stageX=0;this.ratio=1;this.mouseY=this.mouseX=0;this.isTouchDown=this.isMouseDown=!1;b.addEventListener("DOMMouseScroll",l,!0);b.addEventListener("mousewheel",l,!0);b.addEventListener("mousemove",function(c){a.mouseX=void 0!=c.offsetX&&c.offsetX||void 0!=
c.layerX&&c.layerX||void 0!=c.clientX&&c.clientX;a.mouseY=void 0!=c.offsetY&&c.offsetY||void 0!=c.layerY&&c.layerY||void 0!=c.clientY&&c.clientY;if(a.isMouseDown){var b=a.mouseX-s+D,h=a.mouseY-d+q;if(b!=a.stageX||h!=a.stageY)u=x,m=g,x=b,g=h,a.stageX=b,a.stageY=h,a.dispatch("drag")}a.dispatch("move");c.preventDefault?c.preventDefault():c.returnValue=!1},!0);b.addEventListener("mousedown",function(c){a.p.mouseEnabled&&(a.isMouseDown=!0,a.dispatch("mousedown"),D=a.stageX,q=a.stageY,s=a.mouseX,d=a.mouseY,
u=x=a.stageX,m=g=a.stageY,a.dispatch("startdrag"),c.preventDefault?c.preventDefault():c.returnValue=!1)},!0);document.addEventListener("mouseup",function(d){a.p.mouseEnabled&&a.isMouseDown&&(a.isMouseDown=!1,a.dispatch("mouseup"),(D!=a.stageX||q!=a.stageY)&&f(a.stageX+a.p.inertia*(a.stageX-u),a.stageY+a.p.inertia*(a.stageY-m)),d.preventDefault?d.preventDefault():d.returnValue=!1)},!0);b.addEventListener("touchstart",j,!0);b.addEventListener("touchmove",j,!0);document.addEventListener("touchend",j,
!0);b.addEventListener("touchcancel",j,!0);this.checkBorders=function(){return a};this.interpolate=f}function g(b){var l=this;sigma.classes.EventDispatcher.call(this);this._core=b;this.kill=function(){};this.getID=function(){return b.id};this.configProperties=function(f,c){var a=b.config(f,c);return a==b?l:a};this.drawingProperties=function(f,c){var a=b.plotter.config(f,c);return a==b.plotter?l:a};this.mouseProperties=function(f,c){var a=b.mousecaptor.config(f,c);return a==b.mousecaptor?l:a};this.graphProperties=
function(f,c){var a=b.graph.config(f,c);return a==b.graph?l:a};this.getMouse=function(){return{mouseX:b.mousecaptor.mouseX,mouseY:b.mousecaptor.mouseY,down:b.mousecaptor.isMouseDown}};this.position=function(f,c,a){if(0==arguments.length)return{stageX:b.mousecaptor.stageX,stageY:b.mousecaptor.stageY,ratio:b.mousecaptor.ratio};b.mousecaptor.stageX=void 0!=f?f:b.mousecaptor.stageX;b.mousecaptor.stageY=void 0!=c?c:b.mousecaptor.stageY;b.mousecaptor.ratio=void 0!=a?a:b.mousecaptor.ratio;return l};this.goTo=
function(f,c,a){b.mousecaptor.interpolate(f,c,a);return l};this.zoomTo=function(f,c,a){a=Math.min(Math.max(b.mousecaptor.config("minRatio"),a),b.mousecaptor.config("maxRatio"));a==b.mousecaptor.ratio?b.mousecaptor.interpolate(f-b.width/2+b.mousecaptor.stageX,c-b.height/2+b.mousecaptor.stageY):b.mousecaptor.interpolate((a*f-b.mousecaptor.ratio*b.width/2)/(a-b.mousecaptor.ratio),(a*c-b.mousecaptor.ratio*b.height/2)/(a-b.mousecaptor.ratio),a);return l};this.resize=function(f,c){b.resize(f,c);return l};
this.draw=function(f,c,a,s){b.draw(f,c,a,s);return l};this.refresh=function(){b.refresh();return l};this.addGenerator=function(f,c,a){sigma.chronos.addGenerator(f+"_ext_"+b.id,c,a);return l};this.removeGenerator=function(f){sigma.chronos.removeGenerator(f+"_ext_"+b.id);return l};this.addNode=function(f,c){b.graph.addNode(f,c);return l};this.addEdge=function(f,c,a,s){b.graph.addEdge(f,c,a,s);return l};this.dropNode=function(f){b.graph.dropNode(f);return l};this.dropEdge=function(f){b.graph.dropEdge(f);
return l};this.pushGraph=function(f,c){f.nodes&&f.nodes.forEach(function(a){a.id&&(!c||!b.graph.nodesIndex[a.id])&&l.addNode(a.id,a)});f.edges&&f.edges.forEach(function(a){(validID=a.source&&a.target&&a.id)&&(!c||!b.graph.edgesIndex[a.id])&&l.addNode(a.id,a.source,a.target,a)});return l};this.emptyGraph=function(){b.graph.empty();return l};this.getNodesCount=function(){return b.graph.nodes.length};this.getEdgesCount=function(){return b.graph.edges.length};this.iterNodes=function(f,c){b.graph.iterNodes(f,
c);return l};this.iterEdges=function(f,c){b.graph.iterEdges(f,c);return l};this.getNodes=function(f){return b.graph.getNodes(f)};this.getEdges=function(f){return b.graph.getEdges(f)};this.activateMonitoring=function(){return b.monitor.activate()};this.desactivateMonitoring=function(){return b.monitor.desactivate()};b.bind("downnodes upnodes downgraph upgraph",function(b){l.dispatch(b.type,b.content)});b.graph.bind("overnodes outnodes",function(b){l.dispatch(b.type,b.content)})}function r(){function b(a){var c=
{},d;for(d in a)c[d]=a[d];return c}function l(a){var c={};for(k in a)c[k]=a[k];return c}function f(){c.nodes=[];c.nodesIndex={};c.edges=[];c.edgesIndex={};return c}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var c=this;this.p={minNodeSize:0,maxNodeSize:0,minEdgeSize:0,maxEdgeSize:0,scalingMode:"inside",nodesPowRatio:0.5,edgesPowRatio:0};this.borders={};f();this.addNode=function(a,b){if(c.nodesIndex[a])throw Error('Node "'+a+'" already exists.');b=b||{};var d={x:0,y:0,
size:1,degree:0,inDegree:0,outDegree:0,fixed:!1,active:!1,hidden:!1,forceLabel:!1,drawBorder:!1,label:a.toString(),id:a.toString()},f;for(f in b)switch(f){case "id":case "degree":case "inDegree":case "outDegree":break;case "x":case "y":case "size":d[f]=+b[f];break;case "fixed":case "active":case "hidden":case "forceLabel":case "drawBorder":d[f]=!!b[f];break;default:d[f]=b[f]}c.nodes.push(d);c.nodesIndex[a.toString()]=d;return c};this.addEdge=function(a,b,d,f){if(c.edgesIndex[a])throw Error('Edge "'+
a+'" already exists.');if(!c.nodesIndex[b])throw Error("Edge's source \""+b+'" does not exist yet.');if(!c.nodesIndex[d])throw Error("Edge's target \""+d+'" does not exist yet.');f=f||{};b={source:c.nodesIndex[b],target:c.nodesIndex[d],size:1,weight:1,displaySize:0.5,label:a.toString(),id:a.toString(),hidden:!1};b.source.degree++;b.source.outDegree++;b.target.degree++;b.target.inDegree++;for(var q in f)switch(q){case "id":case "source":case "target":case "displaySize":break;case "hidden":b[q]=!!f[q];
break;case "size":case "weight":b[q]=+f[q];break;case "color":b[q]=f[q].toString();break;case "type":b[q]=f[q].toString();break;case "label":b[q]=f[q];break;default:b[q]=f[q]}c.edges.push(b);c.edgesIndex[a.toString()]=b;return c};this.dropNode=function(a){((a instanceof Array?a:[a])||[]).forEach(function(a){if(c.nodesIndex[a]){var d=null;c.nodes.some(function(b,c){return b.id==a?(d=c,!0):!1});null!=d&&c.nodes.splice(d,1);delete c.nodesIndex[a];c.edges=c.edges.filter(function(d){return d.source.id==
a?(delete c.edgesIndex[d.id],d.target.degree--,d.target.inDegree--,!1):d.target.id==a?(delete c.edgesIndex[d.id],d.source.degree--,d.source.outDegree--,!1):!0})}else sigma.log('Node "'+a+'" does not exist.')});return c};this.dropEdge=function(a){((a instanceof Array?a:[a])||[]).forEach(function(a){if(c.edgesIndex[a]){c.edgesIndex[a].source.degree--;c.edgesIndex[a].source.outDegree--;c.edgesIndex[a].target.degree--;c.edgesIndex[a].target.inDegree--;var d=null;c.edges.some(function(b,c){return b.id==
a?(d=c,!0):!1});null!=d&&c.edges.splice(d,1);delete c.edgesIndex[a]}else sigma.log('Edge "'+a+'" does not exist.')});return c};this.iterEdges=function(a,b){var d=b?b.map(function(a){return c.edgesIndex[a]}):c.edges,f=d.map(l);f.forEach(a);d.forEach(function(a,d){var b=f[d],n;for(n in b)switch(n){case "id":case "displaySize":break;case "weight":case "size":a[n]=+b[n];break;case "source":case "target":a[n]=c.nodesIndex[n]||a[n];break;case "hidden":a[n]=!!b[n];break;case "color":case "label":case "type":a[n]=
(b[n]||"").toString();break;default:a[n]=b[n]}});return c};this.iterNodes=function(a,f){var d=f?f.map(function(a){return c.nodesIndex[a]}):c.nodes,l=d.map(b);l.forEach(a);d.forEach(function(a,d){var b=l[d],c;for(c in b)switch(c){case "id":case "degree":case "inDegree":case "outDegree":case "displayX":case "displayY":case "displaySize":break;case "x":case "y":case "size":a[c]=+b[c];break;case "fixed":case "active":case "hidden":case "forceLabel":case "drawBorder":a[c]=!!b[c];break;case "color":case "label":a[c]=
(b[c]||"").toString();break;default:a[c]=b[c]}});return c};this.getEdges=function(a){var b=((a instanceof Array?a:[a])||[]).map(function(a){return l(c.edgesIndex[a])});return a instanceof Array?b:b[0]};this.getNodes=function(a){var f=((a instanceof Array?a:[a])||[]).map(function(a){return b(c.nodesIndex[a])});return a instanceof Array?f:f[0]};this.empty=f;this.rescale=function(a,b,d,f){var l=0,h=0;d&&c.nodes.forEach(function(a){h=Math.max(a.size,h)});f&&c.edges.forEach(function(a){l=Math.max(a.size,
l)});var h=h||1,l=l||1,g,n,x,u;d&&c.nodes.forEach(function(a){n=Math.max(a.x,n||a.x);g=Math.min(a.x,g||a.x);u=Math.max(a.y,u||a.y);x=Math.min(a.y,x||a.y)});var G="outside"==c.p.scalingMode?Math.max(a/Math.max(n-g,1),b/Math.max(u-x,1)):Math.min(a/Math.max(n-g,1),b/Math.max(u-x,1)),j=(c.p.maxNodeSize||h)/G;n+=j;g-=j;u+=j;x-=j;var G="outside"==c.p.scalingMode?Math.max(a/Math.max(n-g,1),b/Math.max(u-x,1)):Math.min(a/Math.max(n-g,1),b/Math.max(u-x,1)),w,p;!c.p.maxNodeSize&&!c.p.minNodeSize?(w=1,p=0):c.p.maxNodeSize==
c.p.minNodeSize?(w=0,p=c.p.maxNodeSize):(w=(c.p.maxNodeSize-c.p.minNodeSize)/h,p=c.p.minNodeSize);var m,r;!c.p.maxEdgeSize&&!c.p.minEdgeSize?(m=1,r=0):(m=c.p.maxEdgeSize==c.p.minEdgeSize?0:(c.p.maxEdgeSize-c.p.minEdgeSize)/l,r=c.p.minEdgeSize);d&&c.nodes.forEach(function(d){d.displaySize=d.size*w+p;d.fixed||(d.displayX=(d.x-(n+g)/2)*G+a/2,d.displayY=(d.y-(u+x)/2)*G+b/2)});f&&c.edges.forEach(function(a){a.displaySize=a.size*m+r});return c};this.translate=function(a,b,d,f,l){var h=Math.pow(d,c.p.nodesPowRatio);
f&&c.nodes.forEach(function(c){c.fixed||(c.displayX=c.displayX*d+a,c.displayY=c.displayY*d+b);c.displaySize*=h});h=Math.pow(d,c.p.edgesPowRatio);l&&c.edges.forEach(function(a){a.displaySize*=h});return c};this.setBorders=function(){c.borders={};c.nodes.forEach(function(a){c.borders.minX=Math.min(void 0==c.borders.minX?a.displayX-a.displaySize:c.borders.minX,a.displayX-a.displaySize);c.borders.maxX=Math.max(void 0==c.borders.maxX?a.displayX+a.displaySize:c.borders.maxX,a.displayX+a.displaySize);c.borders.minY=
Math.min(void 0==c.borders.minY?a.displayY-a.displaySize:c.borders.minY,a.displayY-a.displaySize);c.borders.maxY=Math.max(void 0==c.borders.maxY?a.displayY-a.displaySize:c.borders.maxY,a.displayY-a.displaySize)})};this.checkHover=function(a,b){var d,f,l,h=[],g=[];c.nodes.forEach(function(c){if(c.hidden)c.hover=!1;else{d=Math.abs(c.displayX-a);f=Math.abs(c.displayY-b);l=c.displaySize;var x=c.hover,u=d<l&&f<l&&Math.sqrt(d*d+f*f)<l;x&&!u?(c.hover=!1,g.push(c.id)):u&&!x&&(c.hover=!0,h.push(c.id))}});
h.length&&c.dispatch("overnodes",h);g.length&&c.dispatch("outnodes",g);return c}}function C(b,l,f,c,a,g,d){function j(a){var b=c,d="fixed"==h.p.labelSize?h.p.defaultLabelSize:h.p.labelSizeRatio*a.displaySize;b.font=(h.p.hoverFontStyle||h.p.fontStyle||"")+" "+d+"px "+(h.p.hoverFont||h.p.font||"");b.fillStyle="node"==h.p.labelHoverBGColor?a.color||h.p.defaultNodeColor:h.p.defaultHoverLabelBGColor;b.beginPath();h.p.labelHoverShadow&&(b.shadowOffsetX=0,b.shadowOffsetY=0,b.shadowBlur=4,b.shadowColor=h.p.labelHoverShadowColor);
sigma.tools.drawRoundRect(b,Math.round(a.displayX-d/2-2),Math.round(a.displayY-d/2-2),Math.round(b.measureText(a.label).width+1.5*a.displaySize+d/2+4),Math.round(d+4),Math.round(d/2+2),"left");b.closePath();b.fill();b.shadowOffsetX=0;b.shadowOffsetY=0;b.shadowBlur=0;b.beginPath();b.fillStyle="node"==h.p.nodeBorderColor?a.color||h.p.defaultNodeColor:h.p.defaultNodeBorderColor;b.arc(Math.round(a.displayX),Math.round(a.displayY),a.displaySize+h.p.borderSize,0,2*Math.PI,!0);b.closePath();b.fill();b.beginPath();
b.fillStyle="node"==h.p.nodeHoverColor?a.color||h.p.defaultNodeColor:h.p.defaultNodeHoverColor;b.arc(Math.round(a.displayX),Math.round(a.displayY),a.displaySize,0,2*Math.PI,!0);b.closePath();b.fill();b.fillStyle="node"==h.p.labelHoverColor?a.color||h.p.defaultNodeColor:h.p.defaultLabelHoverColor;b.fillText(a.label,Math.round(a.displayX+1.5*a.displaySize),Math.round(a.displayY+d/2-3));return h}function q(a){if(isNaN(a.x)||isNaN(a.y))throw Error("A node's coordinate is not a number (id: "+a.id+")");
return!a.hidden&&a.displayX+a.displaySize>-z/3&&a.displayX-a.displaySize<4*z/3&&a.displayY+a.displaySize>-n/3&&a.displayY-a.displaySize<4*n/3}sigma.classes.Cascade.call(this);var h=this;this.p={labelColor:"default",defaultLabelColor:"#000",labelHoverBGColor:"default",defaultHoverLabelBGColor:"#fff",labelHoverShadow:!0,labelHoverShadowColor:"#000",labelHoverColor:"default",defaultLabelHoverColor:"#000",labelActiveBGColor:"default",defaultActiveLabelBGColor:"#fff",labelActiveShadow:!0,labelActiveShadowColor:"#000",
labelActiveColor:"default",defaultLabelActiveColor:"#000",labelSize:"fixed",defaultLabelSize:12,labelSizeRatio:2,labelThreshold:6,font:"Arial",hoverFont:"",activeFont:"",fontStyle:"",hoverFontStyle:"",activeFontStyle:"",edgeColor:"source",defaultEdgeColor:"#aaa",defaultEdgeType:"line",defaultNodeColor:"#aaa",nodeHoverColor:"node",defaultNodeHoverColor:"#fff",nodeActiveColor:"node",defaultNodeActiveColor:"#fff",borderSize:0,nodeBorderColor:"node",defaultNodeBorderColor:"#fff",defaultBorderView:"node",
edgesSpeed:200,nodesSpeed:200,labelsSpeed:200};var z=g,n=d;this.currentLabelIndex=this.currentNodeIndex=this.currentEdgeIndex=0;this.task_drawLabel=function(){for(var b=a.nodes.length,d=0;d++<h.p.labelsSpeed&&h.currentLabelIndex<b;)if(h.isOnScreen(a.nodes[h.currentLabelIndex])){var c=a.nodes[h.currentLabelIndex++],l=f;if(c.displaySize>=h.p.labelThreshold||c.forceLabel){var g="fixed"==h.p.labelSize?h.p.defaultLabelSize:h.p.labelSizeRatio*c.displaySize;l.font=h.p.fontStyle+g+"px "+h.p.font;l.fillStyle=
"node"==h.p.labelColor?c.color||h.p.defaultNodeColor:h.p.defaultLabelColor;l.fillText(c.label,Math.round(c.displayX+1.5*c.displaySize),Math.round(c.displayY+g/2-3))}}else h.currentLabelIndex++;return h.currentLabelIndex<b};this.task_drawEdge=function(){for(var b=a.edges.length,c,d,f=0;f++<h.p.edgesSpeed&&h.currentEdgeIndex<b;)if(e=a.edges[h.currentEdgeIndex],c=e.source,d=e.target,e.hidden||c.hidden||d.hidden||!h.isOnScreen(c)&&!h.isOnScreen(d))h.currentEdgeIndex++;else{c=a.edges[h.currentEdgeIndex++];
d=c.source.displayX;var g=c.source.displayY,q=c.target.displayX,j=c.target.displayY,n=c.color;if(!n)switch(h.p.edgeColor){case "source":n=c.source.color||h.p.defaultNodeColor;break;case "target":n=c.target.color||h.p.defaultNodeColor;break;default:n=h.p.defaultEdgeColor}var s=l;switch(c.type||h.p.defaultEdgeType){case "curve":s.strokeStyle=n;s.lineWidth=c.displaySize/3;s.beginPath();s.moveTo(d,g);s.quadraticCurveTo((d+q)/2+(j-g)/4,(g+j)/2+(d-q)/4,q,j);s.stroke();break;default:s.strokeStyle=n,s.lineWidth=
c.displaySize/3,s.beginPath(),s.moveTo(d,g),s.lineTo(q,j),s.stroke()}}return h.currentEdgeIndex<b};this.task_drawNode=function(){for(var c=a.nodes.length,d=0;d++<h.p.nodesSpeed&&h.currentNodeIndex<c;)if(h.isOnScreen(a.nodes[h.currentNodeIndex])){var f=a.nodes[h.currentNodeIndex++],l=Math.round(10*f.displaySize)/10,g=b;if("always"===h.p.defaultBorderView||"node"===h.p.defaultBorderView&&f.drawBorder)g.beginPath(),g.fillStyle="node"==h.p.nodeBorderColor?f.color||h.p.defaultNodeColor:h.p.defaultNodeBorderColor,
g.arc(Math.round(f.displayX),Math.round(f.displayY),f.displaySize+h.p.borderSize,0,2*Math.PI,!0),g.closePath(),g.fill();g.fillStyle=f.color;g.beginPath();g.arc(f.displayX,f.displayY,l,0,2*Math.PI,!0);g.closePath();g.fill();f.hover&&j(f)}else h.currentNodeIndex++;return h.currentNodeIndex<c};this.drawActiveNode=function(a){var b=c;if(!q(a))return h;var d="fixed"==h.p.labelSize?h.p.defaultLabelSize:h.p.labelSizeRatio*a.displaySize;b.font=(h.p.activeFontStyle||h.p.fontStyle||"")+" "+d+"px "+(h.p.activeFont||
h.p.font||"");b.fillStyle="node"==h.p.labelHoverBGColor?a.color||h.p.defaultNodeColor:h.p.defaultActiveLabelBGColor;b.beginPath();h.p.labelActiveShadow&&(b.shadowOffsetX=0,b.shadowOffsetY=0,b.shadowBlur=4,b.shadowColor=h.p.labelActiveShadowColor);sigma.tools.drawRoundRect(b,Math.round(a.displayX-d/2-2),Math.round(a.displayY-d/2-2),Math.round(b.measureText(a.label).width+1.5*a.displaySize+d/2+4),Math.round(d+4),Math.round(d/2+2),"left");b.closePath();b.fill();b.shadowOffsetX=0;b.shadowOffsetY=0;b.shadowBlur=
0;b.beginPath();b.fillStyle="node"==h.p.nodeBorderColor?a.color||h.p.defaultNodeColor:h.p.defaultNodeBorderColor;b.arc(Math.round(a.displayX),Math.round(a.displayY),a.displaySize+h.p.borderSize,0,2*Math.PI,!0);b.closePath();b.fill();b.beginPath();b.fillStyle="node"==h.p.nodeActiveColor?a.color||h.p.defaultNodeColor:h.p.defaultNodeActiveColor;b.arc(Math.round(a.displayX),Math.round(a.displayY),a.displaySize,0,2*Math.PI,!0);b.closePath();b.fill();b.fillStyle="node"==h.p.labelActiveColor?a.color||h.p.defaultNodeColor:
h.p.defaultLabelActiveColor;b.fillText(a.label,Math.round(a.displayX+1.5*a.displaySize),Math.round(a.displayY+d/2-3));return h};this.drawHoverNode=j;this.isOnScreen=q;this.resize=function(a,b){z=a;n=b;return h}}function I(b,g){function f(){var a;a="<p>GLOBAL :</p>";for(var b in c.p.globalProbes)a+="<p>"+b+" : "+c.p.globalProbes[b]()+"</p>";a+="<br><p>LOCAL :</p>";for(b in c.p.localProbes)a+="<p>"+b+" : "+c.p.localProbes[b]()+"</p>";c.p.dom.innerHTML=a;return c}sigma.classes.Cascade.call(this);var c=
this;this.instance=b;this.monitoring=!1;this.p={fps:40,dom:g,globalProbes:{"Time (ms)":sigma.chronos.getExecutionTime,Queue:sigma.chronos.getQueuedTasksCount,Tasks:sigma.chronos.getTasksCount,FPS:sigma.chronos.getFPS},localProbes:{"Nodes count":function(){return c.instance.graph.nodes.length},"Edges count":function(){return c.instance.graph.edges.length}}};this.activate=function(){c.monitoring||(c.monitoring=window.setInterval(f,1E3/c.p.fps));return c};this.desactivate=function(){c.monitoring&&(window.clearInterval(c.monitoring),
c.monitoring=null,c.p.dom.innerHTML="");return c}}function B(b,g){function f(){sigma.chronos.removeTask("node_"+d.id,2).removeTask("edge_"+d.id,2).removeTask("label_"+d.id,2).stopTasks();return d}function c(a,b){d.domElements[a]=document.createElement(b);d.domElements[a].style.position="absolute";d.domElements[a].setAttribute("id","sigma_"+a+"_"+d.id);d.domElements[a].setAttribute("class","sigma_"+a+"_"+b);d.domElements[a].setAttribute("width",d.width+"px");d.domElements[a].setAttribute("height",
d.height+"px");d.domRoot.appendChild(d.domElements[a]);return d}function a(){d.p.drawHoverNodes&&(d.graph.checkHover(d.mousecaptor.mouseX,d.mousecaptor.mouseY),d.graph.nodes.forEach(function(a){a.hover&&!a.active&&d.plotter.drawHoverNode(a)}));return d}function j(){d.p.drawActiveNodes&&d.graph.nodes.forEach(function(a){a.active&&d.plotter.drawActiveNode(a)});return d}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var d=this;this.id=g.toString();this.p={auto:!0,drawNodes:2,
drawEdges:1,drawLabels:2,lastNodes:2,lastEdges:0,lastLabels:2,drawHoverNodes:!0,drawActiveNodes:!0};this.domRoot=b;this.width=this.domRoot.offsetWidth;this.height=this.domRoot.offsetHeight;this.graph=new r;this.domElements={};c("edges","canvas");c("nodes","canvas");c("labels","canvas");c("hover","canvas");c("monitor","div");c("mouse","canvas");this.plotter=new C(this.domElements.nodes.getContext("2d"),this.domElements.edges.getContext("2d"),this.domElements.labels.getContext("2d"),this.domElements.hover.getContext("2d"),
this.graph,this.width,this.height);this.monitor=new I(this,this.domElements.monitor);this.mousecaptor=new t(this.domElements.mouse,this.id);this.mousecaptor.bind("drag interpolate",function(){d.draw(d.p.auto?2:d.p.drawNodes,d.p.auto?0:d.p.drawEdges,d.p.auto?2:d.p.drawLabels,!0)}).bind("stopdrag stopinterpolate",function(){d.draw(d.p.auto?2:d.p.drawNodes,d.p.auto?1:d.p.drawEdges,d.p.auto?2:d.p.drawLabels,!0)}).bind("mousedown mouseup",function(a){var b=d.graph.nodes.filter(function(a){return!!a.hover}).map(function(a){return a.id});
d.dispatch("mousedown"==a.type?"downgraph":"upgraph");b.length&&d.dispatch("mousedown"==a.type?"downnodes":"upnodes",b)}).bind("move",function(){d.domElements.hover.getContext("2d").clearRect(0,0,d.domElements.hover.width,d.domElements.hover.height);a();j()});sigma.chronos.bind("startgenerators",function(){sigma.chronos.getGeneratorsIDs().some(function(a){return!!a.match(RegExp("_ext_"+d.id+"$",""))})&&d.draw(d.p.auto?2:d.p.drawNodes,d.p.auto?0:d.p.drawEdges,d.p.auto?2:d.p.drawLabels)}).bind("stopgenerators",
function(){d.draw()});for(var D=0;D<p.plugins.length;D++)p.plugins[D](this);this.draw=function(a,b,c,g){if(g&&sigma.chronos.getGeneratorsIDs().some(function(a){return!!a.match(RegExp("_ext_"+d.id+"$",""))}))return d;a=void 0==a?d.p.drawNodes:a;b=void 0==b?d.p.drawEdges:b;c=void 0==c?d.p.drawLabels:c;g={nodes:a,edges:b,labels:c};d.p.lastNodes=a;d.p.lastEdges=b;d.p.lastLabels=c;f();d.graph.rescale(d.width,d.height,0<a,0<b).setBorders();d.mousecaptor.checkBorders(d.graph.borders,d.width,d.height);d.graph.translate(d.mousecaptor.stageX,
d.mousecaptor.stageY,d.mousecaptor.ratio,0<a,0<b);d.dispatch("graphscaled");for(var l in d.domElements)"canvas"==d.domElements[l].nodeName.toLowerCase()&&(void 0==g[l]||0<=g[l])&&d.domElements[l].getContext("2d").clearRect(0,0,d.domElements[l].width,d.domElements[l].height);d.plotter.currentEdgeIndex=0;d.plotter.currentNodeIndex=0;d.plotter.currentLabelIndex=0;l=null;g=!1;if(a)if(1<a)for(;d.plotter.task_drawNode(););else sigma.chronos.addTask(d.plotter.task_drawNode,"node_"+d.id,!1),g=!0,l="node_"+
d.id;if(c)if(1<c)for(;d.plotter.task_drawLabel(););else l?sigma.chronos.queueTask(d.plotter.task_drawLabel,"label_"+d.id,l):sigma.chronos.addTask(d.plotter.task_drawLabel,"label_"+d.id,!1),g=!0,l="label_"+d.id;if(b)if(1<b)for(;d.plotter.task_drawEdge(););else l?sigma.chronos.queueTask(d.plotter.task_drawEdge,"edge_"+d.id,l):sigma.chronos.addTask(d.plotter.task_drawEdge,"edge_"+d.id,!1),g=!0,l="edge_"+d.id;d.dispatch("draw");d.refresh();g&&sigma.chronos.runTasks();return d};this.resize=function(a,
b){var c=d.width,f=d.height;void 0!=a&&void 0!=b?(d.width=a,d.height=b):(d.width=d.domRoot.offsetWidth,d.height=d.domRoot.offsetHeight);if(c!=d.width||f!=d.height){for(var g in d.domElements)d.domElements[g].setAttribute("width",d.width+"px"),d.domElements[g].setAttribute("height",d.height+"px");d.plotter.resize(d.width,d.height);d.draw(d.p.lastNodes,d.p.lastEdges,d.p.lastLabels,!0)}return d};this.refresh=function(){d.domElements.hover.getContext("2d").clearRect(0,0,d.domElements.hover.width,d.domElements.hover.height);
a();j();return d};this.drawHover=a;this.drawActive=j;this.clearSchedule=f;window.addEventListener("resize",function(){d.resize()})}var m=0,p={plugins:[]};sigma.init=function(b){b=new B(b,(++m).toString());sigma.instances[m]=new g(b);return sigma.instances[m]};sigma.addPlugin=function(b,l,f){g.prototype[b]=l;p.plugins.push(f)};sigma.easing={linear:{},quadratic:{}};sigma.easing.linear.easenone=function(b){return b};sigma.easing.quadratic.easein=function(b){return b*b};sigma.easing.quadratic.easeout=
function(b){return-b*(b-2)};sigma.easing.quadratic.easeinout=function(b){return 1>(b*=2)?0.5*b*b:-0.5*(--b*(b-2)-1)};sigma.debugMode=0;sigma.log=function(){if(1==sigma.debugMode)for(var b in arguments)console.log(arguments[b]);else if(1<sigma.debugMode)for(b in arguments)throw Error(arguments[b]);return sigma};sigma.chronos=new function(){function b(a){window.setTimeout(a,0);return h}function g(){for(h.dispatch("frameinserted");m&&y.length&&f(););!m||!y.length?a():(F=(new Date).getTime(),u++,H=w-
t,C=t-H,h.dispatch("insertframe"),b(g))}function f(){E%=y.length;if(!y[E].task()){var a=y[E].taskName;A=A.filter(function(b){b.taskParent==a&&y.push({taskName:b.taskName,task:b.task});return b.taskParent!=a});h.dispatch("killed",y.splice(E--,1)[0])}E++;w=(new Date).getTime()-F;return w<=C}function c(){m=!0;u=E=0;B=F=(new Date).getTime();h.dispatch("start");h.dispatch("insertframe");b(g);return h}function a(){h.dispatch("stop");m=!1;return h}function j(a,b,d){if("function"!=typeof a)throw Error('Task "'+
b+'" is not a function');y.push({taskName:b,task:a});m=!(!m&&!(d&&c()||1));return h}function d(a){return a?Object.keys(v).filter(function(a){return!!v[a].on}).length:Object.keys(v).length}function p(){Object.keys(v).length?(h.dispatch("startgenerators"),h.unbind("killed",q),b(function(){for(var a in v)v[a].on=!0,j(v[a].task,a,!1)}),h.bind("killed",q).runTasks()):h.dispatch("stopgenerators");return h}function q(a){void 0!=v[a.content.taskName]&&(v[a.content.taskName].del||!v[a.content.taskName].condition()?
delete v[a.content.taskName]:v[a.content.taskName].on=!1,0==d(!0)&&p())}sigma.classes.EventDispatcher.call(this);var h=this,m=!1,n=80,r=0,u=0,t=1E3/n,C=t,w=0,B=0,F=0,H=0,v={},y=[],A=[],E=0;this.frequency=function(a){return void 0!=a?(n=Math.abs(1*a),t=1E3/n,u=0,h):n};this.runTasks=c;this.stopTasks=a;this.insertFrame=b;this.addTask=j;this.queueTask=function(a,b,c){if("function"!=typeof a)throw Error('Task "'+b+'" is not a function');if(!y.concat(A).some(function(a){return a.taskName==c}))throw Error('Parent task "'+
c+'" of "'+b+'" is not attached.');A.push({taskParent:c,taskName:b,task:a});return h};this.removeTask=function(b,c){if(void 0==b)y=[],1==c?A=[]:2==c&&(y=A,A=[]),a();else{var d="string"==typeof b?b:"";y=y.filter(function(a){return("string"==typeof b?a.taskName==b:a.task==b)?(d=a.taskName,!1):!0});0<c&&(A=A.filter(function(a){1==c&&a.taskParent==d&&y.push(a);return a.taskParent!=d}))}m=!(y.length&&(!a()||1));return h};this.addGenerator=function(a,b,c){if(void 0!=v[a])return h;v[a]={task:b,condition:c};
0==d(!0)&&p();return h};this.removeGenerator=function(a){v[a]&&(v[a].on=!1,v[a].del=!0);return h};this.startGenerators=p;this.getGeneratorsIDs=function(){return Object.keys(v)};this.getFPS=function(){m&&(r=Math.round(1E4*(u/((new Date).getTime()-B)))/10);return r};this.getTasksCount=function(){return y.length};this.getQueuedTasksCount=function(){return A.length};this.getExecutionTime=function(){return F-B};return this};sigma.tools.drawRoundRect=function(b,g,f,c,a,j,d){j=j?j:0;var m=d?d:[],m="string"==
typeof m?m.split(" "):m;d=j&&(0<=m.indexOf("topleft")||0<=m.indexOf("top")||0<=m.indexOf("left"));var p=j&&(0<=m.indexOf("topright")||0<=m.indexOf("top")||0<=m.indexOf("right")),h=j&&(0<=m.indexOf("bottomleft")||0<=m.indexOf("bottom")||0<=m.indexOf("left")),m=j&&(0<=m.indexOf("bottomright")||0<=m.indexOf("bottom")||0<=m.indexOf("right"));b.moveTo(g,f+j);d?b.arcTo(g,f,g+j,f,j):b.lineTo(g,f);p?(b.lineTo(g+c-j,f),b.arcTo(g+c,f,g+c,f+j,j)):b.lineTo(g+c,f);m?(b.lineTo(g+c,f+a-j),b.arcTo(g+c,f+a,g+c-j,
f+a,j)):b.lineTo(g+c,f+a);h?(b.lineTo(g+j,f+a),b.arcTo(g,f+a,g,f+a-j,j)):b.lineTo(g,f+a);b.lineTo(g,f+j)};sigma.tools.getRGB=function(b,g){b=b.toString();var f={r:0,g:0,b:0};if(3<=b.length&&"#"==b.charAt(0)){var c=b.length-1;6==c?f={r:parseInt(b.charAt(1)+b.charAt(2),16),g:parseInt(b.charAt(3)+b.charAt(4),16),b:parseInt(b.charAt(5)+b.charAt(5),16)}:3==c&&(f={r:parseInt(b.charAt(1)+b.charAt(1),16),g:parseInt(b.charAt(2)+b.charAt(2),16),b:parseInt(b.charAt(3)+b.charAt(3),16)})}g&&(f=[f.r,f.g,f.b]);
return f};sigma.tools.rgbToHex=function(b,g,f){return sigma.tools.toHex(b)+sigma.tools.toHex(g)+sigma.tools.toHex(f)};sigma.tools.toHex=function(b){b=parseInt(b,10);if(isNaN(b))return"00";b=Math.max(0,Math.min(b,255));return"0123456789ABCDEF".charAt((b-b%16)/16)+"0123456789ABCDEF".charAt(b%16)};sigma.publicPrototype=g.prototype})();
